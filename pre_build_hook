#!/bin/bash

#!/bin/bash
set -eux

ROOT="$(dirname `readlink -f $0`)"
EK_MODULE="${ROOT}"/deployment_scripts/puppet/modules/elasticsearch
RPM_REPO="${ROOT}"/repositories/centos/
DEB_REPO="${ROOT}"/repositories/ubuntu/
ELASTICSEARCH_TARBALL_URL="https://forgeapi.puppetlabs.com/v3/files/elasticsearch-elasticsearch-0.9.1.tar.gz"

function deb_download {
    FILE=$(basename $1)
    wget -qO - $1 > ${DEB_REPO}/$FILE
}

# Packages needed to install JRE headless
deb_download http://mirrors.kernel.org/ubuntu/pool/main/t/tzdata/tzdata_2015a-0ubuntu0.12.04_all.deb
deb_download http://mirrors.kernel.org/ubuntu/pool/main/t/tzdata/tzdata-java_2015a-0ubuntu0.12.04_all.deb
deb_download http://mirrors.kernel.org/ubuntu/pool/main/p/pcsc-lite/libpcsclite1_1.7.4-2ubuntu2_amd64.deb
deb_download http://mirrors.kernel.org/ubuntu/pool/main/c/ca-certificates-java/ca-certificates-java_20110912ubuntu6_all.deb
deb_download http://mirrors.kernel.org/ubuntu/pool/main/j/java-common/java-common_0.43ubuntu2_all.deb
deb_download http://mirrors.kernel.org/ubuntu/pool/main/o/openjdk-6/openjdk-6-jre-lib_6b34-1.13.6-1ubuntu0.12.04.1_all.deb
deb_download http://mirrors.kernel.org/ubuntu/pool/main/o/openjdk-6/openjdk-6-jre-headless_6b34-1.13.6-1ubuntu0.12.04.1_amd64.deb
deb_download https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.4.4.deb

# Clean-up first
rm -rf ${EK_MODULE}
mkdir -p ${EK_MODULE}

# Include elasticsearch manifest from puppetlabs
wget -qO- "${ELASTICSEARCH_TARBALL_URL}" | tar -C "${EK_MODULE}" --strip-components=1 -xz
